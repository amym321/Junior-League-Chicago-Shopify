(self.webpackJsonp=self.webpackJsonp||[]).push([["legacyEmbeddedApp"],{"./app/components/LeaveConfirmation/LeaveConfirmation.tsx":function(e,t,o){"use strict";var a,n=o("./node_modules/react/index.js"),i=o.n(n),s=o("./node_modules/@shopify/polaris/dist/esnext/components/EventListener/EventListener.tsx.esnext"),r=o("./node_modules/@shopify/polaris/dist/esnext/components/Modal/Modal.tsx.esnext"),l=o("./node_modules/@shopify/react-i18n/dist/src/index.js"),d=o("./node_modules/react-router/esm/react-router.js"),p=o("./node_modules/@shopify/javascript-utilities/decorators/index.js"),c=o("./packages/@web-utilities/decorators/index.ts");function u(e,t,o,a,n){var i={};return Object.keys(a).forEach((function(e){i[e]=a[e]})),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=o.slice().reverse().reduce((function(o,a){return a(e,t,o)||o}),i),n&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(n):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}let h=(u((a=class extends i.a.PureComponent{constructor(){super(...arguments),this.state={open:!1}}componentDidMount(){this.enableLeaveHook()}componentWillUnmount(){this.disableLeaveHook()}render(){const{i18n:e,title:t,description:o}=this.props,{open:a}=this.state,n=null==t?e.translate("LeaveConfirmation.title"):t,l=null==o?e.translate("LeaveConfirmation.content"):o;return i.a.createElement(i.a.Fragment,null,i.a.createElement(s.a,{event:"beforeunload",handler:this.beforeUnload}),i.a.createElement(r.a,{title:n,open:a,secondaryActions:[{content:e.translate("Common.cancel"),onAction:this.handleClose},{content:e.translate("LeaveConfirmation.confirmLabel"),onAction:this.handleConfirm,destructive:!0}],onClose:this.handleClose},i.a.createElement(r.a.Section,null,l)))}disableLeaveHook(){this.removeLeaveHook&&(this.removeLeaveHook(),this.removeLeaveHook=null)}enableLeaveHook(){const{history:e}=this.props;this.removeLeaveHook&&this.removeLeaveHook(),this.removeLeaveHook=e.block(this.handleRouteLeave)}beforeUnload(e){return e.returnValue=!0,!0}handleRouteLeave(e){const{location:t}=this.props;if(!e||e.pathname!==t.pathname)return this.setState({nextLocation:e,open:!0}),!1}handleClose(){this.setState({open:!1})}handleConfirm(){const{nextLocation:e}=this.state,{history:t,onConfirm:o}=this.props;e&&(o&&o(),this.disableLeaveHook(),t.push(e))}}).prototype,"beforeUnload",[p.autobind],Object.getOwnPropertyDescriptor(a.prototype,"beforeUnload"),a.prototype),u(a.prototype,"handleRouteLeave",[p.autobind],Object.getOwnPropertyDescriptor(a.prototype,"handleRouteLeave"),a.prototype),u(a.prototype,"handleClose",[p.autobind],Object.getOwnPropertyDescriptor(a.prototype,"handleClose"),a.prototype),u(a.prototype,"handleConfirm",[p.autobind],Object.getOwnPropertyDescriptor(a.prototype,"handleConfirm"),a.prototype),a);t.a=Object(c.a)(d.l,Object(l.withI18n)())(h)},"./app/sections/OnlineStore/EmbeddedApp/legacy/components/AppChrome/components/Frame/Frame.scss":function(e,t,o){e.exports={Frame:"_3jL0E",hidden:"_14Ieh"}},"./app/sections/OnlineStore/EmbeddedApp/legacy/index.ts":function(e,t,o){"use strict";o.r(t);var a,n=o("./node_modules/react/index.js"),i=o.n(n),s=o("./node_modules/@shopify/react-performance/dist/src/index.js"),r=o("./node_modules/@shopify/javascript-utilities/decorators/index.js"),l=o("./packages/@web-utilities/decorators/index.ts"),d=o("./app/utilities/app/index.tsx"),p=o("./node_modules/react-router/esm/react-router.js"),c=o("./packages/@web-utilities/url/decorator.tsx"),u=o("./app/utilities/request-details/decorator.tsx"),h=o("./packages/@web-utilities/network/index.ts"),m=o("./app/sections/OnlineStore/utilities/bugsnag.ts"),f=o("./app/sections/OnlineStore/types.ts"),g=o("./node_modules/lodash/isEqual.js"),b=o.n(g),y=o("./node_modules/@shopify/polaris/dist/esnext/components/Loading/Loading.tsx.esnext"),v=o("./node_modules/@shopify/polaris/dist/esnext/components/ContextualSaveBar/ContextualSaveBar.tsx.esnext"),L=o("./node_modules/@shopify/polaris/dist/esnext/components/Toast/Toast.tsx.esnext"),O=o("./packages/@shopify/safe-redirect/index.ts"),x=o("./app/components/DocumentTitle/DocumentTitle.tsx"),A=o("./app/components/LeaveConfirmation/LeaveConfirmation.tsx"),E=o("./app/components/FeedbackModal/index.ts"),C=o("./packages/@web-utilities/router/utilities.ts"),P=o("./packages/@web-utilities/other/index.ts"),I=o("./packages/@web-utilities/url/utilities.ts"),j=o("./packages/@web-utilities/new-design-language/with-new-design-language.tsx"),w=o("./app/utilities/interop.ts"),M=o("./app/sections/OnlineStore/utilities/url.ts"),S=o("./app/sections/OnlineStore/EmbeddedApp/shared/components/Modal/Modal.tsx"),k=o("./node_modules/@shopify/css-utilities/dist/index.js"),R=o("./node_modules/@shopify/polaris/dist/esnext/components/EventListener/EventListener.tsx.esnext"),B=o("./app/sections/OnlineStore/EmbeddedApp/legacy/components/AppChrome/components/Frame/Frame.scss"),T=o.n(B);function D(e,t,o,a,n){var i={};return Object.keys(a).forEach((function(e){i[e]=a[e]})),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=o.slice().reverse().reduce((function(o,a){return a(e,t,o)||o}),i),n&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(n):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var _=(D((a=class extends i.a.PureComponent{constructor(){super(...arguments),this.state={mounted:!1}}componentDidMount(){this.setState({mounted:!0})}render(){const{title:e,src:t,onLoad:o,hidden:a}=this.props,{mounted:n}=this.state,s=Object(k.classNames)(T.a.Frame,a&&T.a.hidden);return i.a.createElement(i.a.Fragment,null,i.a.createElement(R.a,{event:"message",handler:this.handleMessage}),n?i.a.createElement("iframe",{className:s,title:e,src:t,name:"app-iframe",ref:this.setIframeRef,onLoad:o,tabIndex:a?-1:void 0}):null)}setIframeRef(e){const{iframeRef:t}=this.props;null!=e&&t(e)}handleMessage(e){const{onMessage:t,host:o}=this.props,a=!e.origin||"null"===e.origin;if(e.source===window||a)return;const{host:n}=new URL(e.origin);if(n===o)try{t(JSON.parse(e.data))}catch(i){console.error(i)}}}).prototype,"setIframeRef",[r.autobind],Object.getOwnPropertyDescriptor(a.prototype,"setIframeRef"),a.prototype),D(a.prototype,"handleMessage",[r.autobind],Object.getOwnPropertyDescriptor(a.prototype,"handleMessage"),a.prototype),a);function F({origin:e,pathname:t,search:o,hash:a}){const n=new URL(t,e);return o&&(n.search=o),a&&(n.hash=a),n.toString()}var z,U=function(e,t,o,a){return new(o||(o=Promise))((function(n,i){function s(e){try{l(a.next(e))}catch(t){i(t)}}function r(e){try{l(a.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,r)}l((a=a.apply(e,t||[])).next())}))};function N(e,t,o,a,n){var i={};return Object.keys(a).forEach((function(e){i[e]=a[e]})),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=o.slice().reverse().reduce((function(o,a){return a(e,t,o)||o}),i),n&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(n):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}let H;!function(e){e.Initialize="Shopify.API.initialize",e.PageLoaded="Shopify.API.Page.Loaded",e.PageUpdateTitle="Shopify.API.Page.UpdateTitle",e.ModalOpen="Shopify.API.Modal.open",e.ModalClose="Shopify.API.Modal.close",e.ModalInitialze="Shopify.API.Modal.initialize",e.ModalFrameLoaded="Shopify.API.Modal.frameLoaded",e.ModalUpdateHeight="Shopify.API.Modal.updateHeight",e.FeedbackModalOpen="Shopify.API.FeedbackModal.open",e.ToastNotice="Shopify.API.flash.notice",e.ToastError="Shopify.API.flash.error",e.LoadingStart="Shopify.API.Bar.loading.on",e.LoadingEnd="Shopify.API.Bar.loading.off",e.NavSelect="Shopify.API.Nav.select",e.RouteReplaceEvent="Shopify.API.replaceState",e.RoutePushEvent="Shopify.API.pushState",e.RouteChangedEvent="Shopify.API.URL.update",e.ContextBarShow="Shopify.API.ContextBar.show",e.ContextBarHide="Shopify.API.ContextBar.hide",e.ContextBarPrimaryClick="Shopify.API.ContextBar.primaryClick",e.ContextBarCancelClick="Shopify.API.ContextBar.cancelClick",e.LeaveConfirmationEnable="Shopify.API.LeaveConfirmation.enable",e.LeaveConfirmationDisable="Shopify.API.LeaveConfirmation.disable",e.RemoteRedirect="Shopify.API.remoteRedirect",e.AppReload="Shopify.API.appReload",e.NewDesignLanguageToggle="Shopify.API.Overrides.NewDesignLanguage"}(H||(H={}));let q=(N((z=class extends i.a.PureComponent{constructor(){super(...arguments),this.state={enableLeaveConfirmation:!1,leaveConfirmationPayload:null,contextBar:{visible:!1},modal:null,feedbackModalId:null,toastMessage:null,showLoadingBar:!1,iframeSrc:F(this.props.frameUrl),pageTitle:null},this.iframe=null,this.resolveIframeLoaded=P.g,this.iframeLoaded=new Promise(e=>{this.resolveIframeLoaded=e})}UNSAFE_componentWillUpdate(e){const{locationDescriptor:t}=this.props,{locationDescriptor:o,isRoutePartOfPartialRollout:a}=e;b()(t,o)||this.handleLocationChange(o,a)}componentDidUpdate(e,t){const{modal:o}=this.state,{newDesignLanguage:a}=this.props,{newDesignLanguage:n}=e;a!==n&&this.handleNewDesignLanguageUpdate(a),null!=t.modal&&null==o&&this.postMessage(H.ModalClose,{result:!1,data:"Modal closed because of background click"})}render(){const{toastMessage:e,iframeSrc:t,showLoadingBar:o,pageTitle:a,enableLeaveConfirmation:n,leaveConfirmationPayload:s,feedbackModalId:r}=this.state,{title:l,requestDetails:{shopDomain:d},iframeHidden:p}=this.props,c=o&&i.a.createElement(y.a,null),u=e&&this.renderToastMessage(),h=a&&i.a.createElement(x.a,{title:a}),m=n&&i.a.createElement(A.a,s),f=a?`${l} ${a}`:l,g=i.a.createElement(E.a,{open:null!==r,id:r,onClose:this.handleFeedbackModalClose});return i.a.createElement(i.a.Fragment,null,h,i.a.createElement(_,{title:f,src:t,host:d,onMessage:this.handleMessage,iframeRef:this.setIframeRef,onLoad:this.handleIframeLoad,hidden:p}),this.renderModal(),u,c,this.renderContextBar(),m,g)}handleIframeLoad(){const{errorLogger:e,onIframeLoaded:t}=this.props;t(),this.resolveIframeLoaded(),e.leaveBreadcrumb(m.a,{event:"Iframe Loaded"})}renderContextBar(){const{contextBar:e}=this.state,{visible:t,primaryAction:o,message:a,cancelAction:n}=e,s=null==o?void 0:Object.assign(Object.assign({},o),{onAction:this.handleContextBarPrimaryAction}),r=null==n?void 0:Object.assign(Object.assign({},n),{onAction:this.handleContextBarCancelAction});return t?i.a.createElement(v.a,{message:a,saveAction:s,discardAction:r}):null}handleContextBarPrimaryAction(){this.postMessage(H.ContextBarPrimaryClick)}handleContextBarCancelAction(){this.postMessage(H.ContextBarCancelClick)}handleNewDesignLanguageUpdate(e){this.postMessage(H.NewDesignLanguageToggle,{enabled:e})}renderToastMessage(){const{toastMessage:e}=this.state;if(null==e)return null;const{message:t,error:o}=e;return i.a.createElement(L.a,{error:o,onDismiss:this.handleDismiss,duration:3e3,testID:"ToastComponent",content:t})}handleDismiss(){this.setState({toastMessage:null})}renderModal(){const{modal:e}=this.state;return e?i.a.createElement(S.b,{open:e.open,onClose:this.closeModal,title:e.title,large:e.large,height:e.height,src:e.src,onLoad:this.handleModalFrameLoad}):null}handleModalFrameLoad(){const{errorLogger:e}=this.props;this.postMessage(H.ModalFrameLoaded,{frameName:S.a}),e.leaveBreadcrumb(m.a,{event:"Embedded Modal Iframe Loaded"})}initializeModal(e){Object(O.a)(e)&&this.setState({modal:{open:!1,src:e,height:void 0}})}updateModal(e){this.setState(t=>null==t.modal?null:{modal:Object.assign(Object.assign({},t.modal),e)})}openModal(e,t,o){this.updateModal({open:!0,title:e,height:t,large:o})}openFeedbackModal(e){this.setState({feedbackModalId:e})}handleFeedbackModalClose(){this.setState({feedbackModalId:null})}updateModalHeight(e){this.updateModal({height:e})}closeModal(){this.updateModal({open:!1,title:void 0,height:void 0}),this.postMessage(H.ModalClose,{result:!1,data:"Modal closed because of background click"})}setIframeRef(e){this.iframe=e}postMessage(e,t){return U(this,void 0,void 0,(function*(){yield this.iframeLoaded,null!=this.iframe&&null!=this.iframe.contentWindow&&this.iframe.contentWindow.postMessage(JSON.stringify({message:e,data:t}),"*")}))}handleMessage({message:e,data:t}){const{errorLogger:o,onAppBridgeInitialized:a}=this.props;switch(o.leaveBreadcrumb(m.a,{method:e,payload:t?JSON.stringify(t):void 0}),e){case H.Initialize:a();break;case H.PageLoaded:this.onRouteLoaded();break;case H.PageUpdateTitle:this.onPageUpdateTitle(t);break;case H.ModalInitialze:this.initializeModal(t.src);break;case H.ModalOpen:this.openModal(t.title,t.height,t.large);break;case H.ModalUpdateHeight:this.updateModalHeight(t.height);break;case H.ModalClose:this.closeModal();break;case H.FeedbackModalOpen:this.openFeedbackModal(t.id);break;case H.ToastNotice:this.showToastNotice(t.message);break;case H.ToastError:this.showToastError(t.message);break;case H.LoadingStart:this.showLoadingBar();break;case H.LoadingEnd:this.hideLoadingBar();break;case H.ContextBarHide:this.handleContextBarEvents(t,!1);break;case H.ContextBarShow:this.handleContextBarEvents(t,!0);break;case H.AppReload:this.handleAppReload();break;case H.LeaveConfirmationEnable:this.setState({leaveConfirmationPayload:t}),this.handleLeaveConfirmationEnable();break;case H.LeaveConfirmationDisable:this.handleLeaveConfirmationDisable();break;case H.RouteReplaceEvent:this.handleRouteReplaceEvent({pathname:t.pathname,search:Object(C.c)(t.query),state:t.state,hash:t.hash});break;case H.RoutePushEvent:this.handleRoutePushEvent({pathname:t.pathname,search:Object(C.c)(t.query),state:t.state,hash:t.hash});break;case H.RemoteRedirect:this.handleRemoteRedirect(t.location);break;default:if(null==e)return;o.notify({name:m.a,message:"Received unhandled App Bridge action: "+e},{severity:"warning"})}}handleAppReload(){this.props.onAppReload()}handleRemoteRedirect(e){Object(O.a)(e)&&window.location.assign(e)}handleLeaveConfirmationEnable(){this.setState({enableLeaveConfirmation:!0})}handleLeaveConfirmationDisable(){this.setState({enableLeaveConfirmation:!1})}onPageUpdateTitle(e){this.setState({pageTitle:e})}onRouteLoaded(){const{onRouteLoaded:e,isRoutePartOfPartialRollout:t}=this.props;t&&this.iframe&&this.iframe.focus(),this.resolveIframeLoaded(),e()}showLoadingBar(){this.setState({showLoadingBar:!0})}hideLoadingBar(){this.setState({showLoadingBar:!1})}handleContextBarEvents(e,t){if(t){const{cancelAction:o,primaryAction:a,message:n}=e;this.setState({contextBar:{visible:t,cancelAction:o,primaryAction:a,message:n}})}else this.setState({contextBar:{visible:t}})}showToastNotice(e){this.setState({toastMessage:{message:e,error:!1}})}showToastError(e){this.setState({toastMessage:{message:e,error:!0}})}handleRouteReplaceEvent({pathname:e,search:t,state:o,hash:a}){const{adminPath:n,history:i}=this.props,s=Object(I.q)(e,n);this.isAdminNextThemeEditorRequest(s)?window.location.replace(this.getFullLocation(s,t,a)):i.replace({pathname:s,search:t,state:o,hash:a})}handleRoutePushEvent({pathname:e,search:t,state:o,hash:a}){const{adminPath:n,history:i}=this.props,s=Object(I.q)(e,n);e&&Object(I.g)(e)?this.handleRemoteRedirect(this.getFullLocation(e,t,a)):this.isAdminNextThemeEditorRequest(s)?this.handleRemoteRedirect(this.getFullLocation(s,t,a)):i.push({pathname:s,search:t,state:o,hash:a})}getFullLocation(e,t,o){return`${e}${t?"?"+t:""}${o?"#"+o:""}`}isAdminNextThemeEditorRequest(e){const{requestDetails:{onlineStoreWebThemeEditorRouteEnabled:t},location:{search:o}}=this.props;return Object(w.b)(e)&&!t&&!Object(M.g)(o)}handleLocationChange(e,t){this.postMessage(H.RouteChangedEvent,t?e:{pathname:"/blank"})}}).prototype,"handleIframeLoad",[r.autobind],Object.getOwnPropertyDescriptor(z.prototype,"handleIframeLoad"),z.prototype),N(z.prototype,"handleContextBarPrimaryAction",[r.autobind],Object.getOwnPropertyDescriptor(z.prototype,"handleContextBarPrimaryAction"),z.prototype),N(z.prototype,"handleContextBarCancelAction",[r.autobind],Object.getOwnPropertyDescriptor(z.prototype,"handleContextBarCancelAction"),z.prototype),N(z.prototype,"handleNewDesignLanguageUpdate",[r.autobind],Object.getOwnPropertyDescriptor(z.prototype,"handleNewDesignLanguageUpdate"),z.prototype),N(z.prototype,"handleDismiss",[r.autobind],Object.getOwnPropertyDescriptor(z.prototype,"handleDismiss"),z.prototype),N(z.prototype,"handleModalFrameLoad",[r.autobind],Object.getOwnPropertyDescriptor(z.prototype,"handleModalFrameLoad"),z.prototype),N(z.prototype,"handleFeedbackModalClose",[r.autobind],Object.getOwnPropertyDescriptor(z.prototype,"handleFeedbackModalClose"),z.prototype),N(z.prototype,"closeModal",[r.autobind],Object.getOwnPropertyDescriptor(z.prototype,"closeModal"),z.prototype),N(z.prototype,"setIframeRef",[r.autobind],Object.getOwnPropertyDescriptor(z.prototype,"setIframeRef"),z.prototype),N(z.prototype,"handleMessage",[r.autobind],Object.getOwnPropertyDescriptor(z.prototype,"handleMessage"),z.prototype),z);var W=Object(l.a)(p.l,Object(d.a)(),Object(u.a)(),Object(j.a)())(q);var $,J=function(e,t,o,a){return new(o||(o=Promise))((function(n,i){function s(e){try{l(a.next(e))}catch(t){i(t)}}function r(e){try{l(a.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,r)}l((a=a.apply(e,t||[])).next())}))};function Q(e,t,o,a,n){var i={};return Object.keys(a).forEach((function(e){i[e]=a[e]})),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=o.slice().reverse().reduce((function(o,a){return a(e,t,o)||o}),i),n&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(n):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}const K=["hmac","shop","locale","session","timestamp","shopId","sessionId"];let V=(Q(($=class extends i.a.PureComponent{constructor(){super(...arguments),this.state={frameUrl:this.getFrameUrl(),reloadCount:0,appLoaded:!1},this.appBridgeInitialized=!1}componentDidMount(){this.setAppBridgeInitializationTimeout(),this.setAppLoadTimeout()}componentWillUnmount(){this.clearAppBridgeInitializationTimeout(),this.clearAppLoadTimeout()}componentDidUpdate(){const{frameUrl:e}=this.state;null===e&&this.appUrl&&this.setState({frameUrl:this.getFrameUrl()})}render(){const{frameUrl:e,reloadCount:t}=this.state,{url:o,location:{pathname:a,search:n,state:r,hash:l},requestDetails:{onlineStoreWebAppDetails:d},isRoutePartOfPartialRollout:p,iframeHidden:c}=this.props,u=o.home();if(null==d||null==e)return null;const h=this.appBridgeInitialized?i.a.createElement(s.PerformanceMark,{id:"OnlineStore",stage:"complete"}):null;return i.a.createElement(i.a.Fragment,null,i.a.createElement(W,{key:t,title:d.title,frameUrl:e,locationDescriptor:{pathname:this.validatePathname(a),search:n,state:r,hash:l},adminPath:u,onAppReload:this.handleAppReload,onAppBridgeInitialized:this.handleAppBridgeInitialization,onIframeLoaded:this.handleIframeLoaded,onRouteLoaded:this.handleRouteLoaded,iframeHidden:c,isRoutePartOfPartialRollout:p}),h)}handleAppBridgeInitialization(){const{errorLogger:e}=this.props;this.clearAppBridgeInitializationTimeout(),this.appBridgeInitialized=!0,e.leaveBreadcrumb(m.a,{event:"App Bridge Initialized"})}loginIsRequired(){return J(this,void 0,void 0,(function*(){const{errorLogger:e}=this.props;let t=!1;try{const o=yield fetch("/admin/shop.json",{method:"GET",headers:new Headers({"X-Shopify-Web":"1"})});t=Object(h.e)(o),e.leaveBreadcrumb(m.a,{event:"Performing Rails session expiry check",loginRequired:t})}catch(o){e.notify(o)}return t}))}handleIframeLoaded(){return J(this,void 0,void 0,(function*(){var e;if(yield(e=50,new Promise(t=>setTimeout(t,e))),this.appBridgeInitialized)return;const{errorLogger:t,onAppLoadFailure:o}=this.props,{reloadCount:a}=this.state;t.leaveBreadcrumb(m.a,{event:"Received iframe load event before App Bridge initialization"}),this.clearAppBridgeInitializationTimeout(),this.clearAppLoadTimeout();(yield this.loginIsRequired())?o({reason:f.a.Unauthenticated}):this.appBridgeInitialized&&this.state.appLoaded?t.notify(new Error(`[${m.a}] Detected race condition between iframe load event and app bridge initialization`),{severity:"info"}):0!==a?o({reason:f.a.Unknown}):this.handleAppReload(!1)}))}handleAppReload(e=!0){return J(this,void 0,void 0,(function*(){const{errorLogger:t,onAppLoadFailure:o,onReload:a}=this.props;if(e){if(yield this.loginIsRequired())return void o({reason:f.a.Unauthenticated})}this.appBridgeInitialized=!1,this.setAppLoadTimeout(),a(),this.setState(e=>{const{reloadCount:t}=e;return{reloadCount:t+1,frameUrl:this.getFrameUrl()}},()=>{t.leaveBreadcrumb(m.a,{event:"Reloading iframe and reinitializing App Bridge",reloadCount:this.state.reloadCount})})}))}setAppLoadTimeout(){this.appLoadTimeout=window.setTimeout(this.checkAppLoaded,9e4)}clearAppLoadTimeout(){clearTimeout(this.appLoadTimeout),this.appLoadTimeout=void 0}setAppBridgeInitializationTimeout(){this.appBridgeInitializationTimeout=window.setTimeout(this.checkAppBridgeInitialized,2500)}clearAppBridgeInitializationTimeout(){clearTimeout(this.appBridgeInitializationTimeout),this.appBridgeInitializationTimeout=void 0}checkAppBridgeInitialized(){return J(this,void 0,void 0,(function*(){const{errorLogger:e,onAppLoadFailure:t}=this.props;if(!this.appBridgeInitialized){e.leaveBreadcrumb(m.a,{event:"App bridge was not initialized before 2500ms timeout"});(yield this.loginIsRequired())&&t({reason:f.a.Unauthenticated})}}))}checkAppLoaded(){const{appLoaded:e}=this.state,{onAppLoadFailure:t}=this.props;e||t({reason:f.a.Timeout})}handleRouteLoaded(){const{errorLogger:e,onRouteLoaded:t}=this.props,{appLoaded:o}=this.state;o||(this.clearAppLoadTimeout(),this.setState({appLoaded:!0})),e.leaveBreadcrumb(m.a,{event:"Route successfully loaded"}),t()}getFrameUrl(){const{location:e,requestDetails:{shopId:t,sessionId:o,shopDomain:a}}=this.props,n=this.appUrl;if(null===n)return null;const{search:i}=new URL(n),s=this.validatePathname(e.pathname),r=new URLSearchParams(i);Array.from(new URLSearchParams(e.search).entries()).forEach(([e,t])=>{K.includes(e)||r.append(e,t)}),r.append("shopId",t),r.append("sessionId",o);return{origin:"https://"+a,pathname:"/admin/online-store"+s,search:"?"+r.toString(),hash:e.hash}}get appUrl(){const{requestDetails:{onlineStoreWebAppDetails:e}}=this.props;return null==e||null==e.installation?null:e.installation.appUrl}validatePathname(e){const{url:t,isRoutePartOfPartialRollout:o}=this.props,a=t.home();return o?e.replace(a,""):"/blank"}}).prototype,"handleAppBridgeInitialization",[r.autobind],Object.getOwnPropertyDescriptor($.prototype,"handleAppBridgeInitialization"),$.prototype),Q($.prototype,"handleIframeLoaded",[r.autobind],Object.getOwnPropertyDescriptor($.prototype,"handleIframeLoaded"),$.prototype),Q($.prototype,"handleAppReload",[r.autobind],Object.getOwnPropertyDescriptor($.prototype,"handleAppReload"),$.prototype),Q($.prototype,"setAppLoadTimeout",[r.autobind],Object.getOwnPropertyDescriptor($.prototype,"setAppLoadTimeout"),$.prototype),Q($.prototype,"checkAppBridgeInitialized",[r.autobind],Object.getOwnPropertyDescriptor($.prototype,"checkAppBridgeInitialized"),$.prototype),Q($.prototype,"checkAppLoaded",[r.autobind],Object.getOwnPropertyDescriptor($.prototype,"checkAppLoaded"),$.prototype),Q($.prototype,"handleRouteLoaded",[r.autobind],Object.getOwnPropertyDescriptor($.prototype,"handleRouteLoaded"),$.prototype),$);var G=Object(l.a)(p.l,Object(d.a)(),Object(c.a)(),Object(u.a)())(V);o.d(t,"SHOP_PARAMETER",(function(){return"shopId"})),o.d(t,"SESSION_ID_PARAMETER",(function(){return"sessionId"})),o.d(t,"APP_LOAD_TIMEOUT",(function(){return 9e4})),o.d(t,"APP_BRIDGE_INIT_TIMEOUT",(function(){return 2500})),o.d(t,"IFRAME_ONLOAD_EVENT_TIMEOUT",(function(){return 50})),o.d(t,"AUTH_CHECK_ENDPOINT",(function(){return"/admin/shop.json"})),o.d(t,"ONLINE_STORE_PROXY_PATH",(function(){return"/admin/online-store"})),o.d(t,"RESERVED_SEARCH_PARAMS",(function(){return K}));t.default=G},"./app/sections/OnlineStore/EmbeddedApp/shared/components/Modal/Modal.scss":function(e,t,o){e.exports={BodyWrapper:"_3rIYW",Body:"u9ptj",Spinner:"_1_LjN",Iframe:"s21TL",lockScrolling:"ffg6h"}},"./app/sections/OnlineStore/EmbeddedApp/shared/components/Modal/Modal.tsx":function(e,t,o){"use strict";var a=o("./node_modules/react/index.js"),n=o.n(a),i=o("./packages/@web-utilities/env/index.ts"),s=o("./node_modules/@shopify/polaris/dist/esnext/components/Backdrop/Backdrop.tsx.esnext"),r=o("./node_modules/@shopify/polaris/dist/esnext/components/Portal/Portal.tsx.esnext"),l=o("./node_modules/@shopify/polaris/dist/esnext/components/Stack/Stack.tsx.esnext"),d=o("./node_modules/@shopify/polaris/dist/esnext/components/DisplayText/DisplayText.tsx.esnext"),p=o("./node_modules/@shopify/polaris/dist/esnext/components/Truncate/Truncate.tsx.esnext"),c=o("./app/sections/OnlineStore/EmbeddedApp/shared/components/Modal/components/Header/Header.scss"),u=o.n(c),h=o("./node_modules/@shopify/css-utilities/dist/index.js"),m=o("./node_modules/@shopify/polaris/dist/esnext/components/Icon/Icon.tsx.esnext"),f=o("./node_modules/@shopify/polaris-icons/dist/icons/MobileCancelMajor.svg.mjs");function g({title:e=!0,onClick:t}){const o=Object(h.classNames)(u.a.CloseButton,!e&&u.a.withoutTitle);return n.a.createElement("button",{type:"button",onClick:t,className:o},n.a.createElement(m.a,{source:f.a,color:"inkLighter"}))}var b=function({id:e,children:t,onClose:o}){return n.a.createElement("div",{className:u.a.Header},n.a.createElement(l.a,{alignment:"center",wrap:!1},n.a.createElement(l.a.Item,{fill:!0},n.a.createElement("div",{id:e},n.a.createElement(d.a,{element:"h2",size:"small"},n.a.createElement(p.a,null,t)))),n.a.createElement(g,{onClick:o})))},y=o("./node_modules/@shopify/polaris/dist/esnext/components/KeypressListener/KeypressListener.tsx.esnext"),v=o("./node_modules/@shopify/polaris/dist/esnext/types.ts.esnext"),L=o("./packages/@shopify/polaris-next/components/Focus/TrapFocus.tsx"),O=o("./app/sections/OnlineStore/EmbeddedApp/shared/components/Modal/components/Dialog/Dialog.scss"),x=o.n(O);function A(e){return n.a.createElement("div",{className:Object(h.classNames)(x.a.Container,e.visible&&x.a.visible),"data-polaris-layer":!0,"data-polaris-overlay":!0},e.children)}var E=function({open:e,labelledBy:t,children:o,onClose:a,large:i,limitHeight:s,width:r,height:l}){const d=Object(h.classNames)(x.a.Modal,i&&x.a["Modal-large"],s&&x.a["Modal-limitHeight"]);return n.a.createElement(A,{visible:e},n.a.createElement(L.a,null,e=>n.a.createElement("div",{className:d,role:"dialog","aria-labelledby":t,style:{width:r,height:l},tabIndex:-1,ref:e},n.a.createElement(y.a,{keyCode:v.a.Escape,handler:a}),o)))},C=o("./app/sections/OnlineStore/EmbeddedApp/shared/components/Modal/Modal.scss"),P=o.n(C);o.d(t,"a",(function(){return I})),o.d(t,"b",(function(){return j}));const I="app-modal-iframe";function j({height:e,large:t,limitHeight:o,open:l,onClose:d,onLoad:p,src:c,title:u,width:h}){const m=l?n.a.createElement(s.a,null):null,f=l&&u?n.a.createElement(b,{id:"embedded-modal-header",onClose:d},u):null;return Object(a.useEffect)(()=>(l?function(){if(i.f)return;document.body.classList.add(P.a.lockScrolling)}():w(),w),[l]),n.a.createElement(r.a,{idPrefix:"embedded-modal"},n.a.createElement(E,{open:!0===l,labelledBy:"embedded-modal-header",onClose:d,limitHeight:o,width:h,large:t,height:e},f,n.a.createElement("div",{className:P.a.Body},n.a.createElement("iframe",{title:u,src:c,className:P.a.Iframe,onLoad:p,name:I}))),m)}function w(){i.f||document.body.classList.remove(P.a.lockScrolling)}},"./app/sections/OnlineStore/EmbeddedApp/shared/components/Modal/components/Dialog/Dialog.scss":function(e,t,o){e.exports={Container:"_2Ph5d",visible:"_3hayx",scaleIn:"_2p9QW",Modal:"fMI_2",limitHeight:"ZLe7c","Modal-large":"tkeQq",IFrame:"uqFSj"}},"./app/sections/OnlineStore/EmbeddedApp/shared/components/Modal/components/Header/Header.scss":function(e,t,o){e.exports={Header:"QUQkW",withoutTitle:"_1Cpk_",CloseButton:"_2_NAy"}},"./node_modules/@shopify/javascript-utilities/dom.js":function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.nodeContainsDescendant=function(e,t){if(e===t)return!0;for(var o=t.parentNode;null!=o;){if(o===e)return!0;o=o.parentNode}return!1},t.matches=function(e,t){if(e.matches)return e.matches(t);for(var o=(e.ownerDocument||document).querySelectorAll(t),a=o.length;--a>=0&&o.item(a)!==e;);return a>-1},t.closest=function(e,t){if(e.closest)return e.closest(t);var o,a=document.querySelectorAll(t),n=e;do{for(n=n.parentElement,o=a.length;--o>=0&&a.item(o)!==n;);}while(o<0&&n);return n}},"./node_modules/@shopify/javascript-utilities/focus.js":function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=o("./node_modules/@shopify/javascript-utilities/dom.js");function n(e,o){return void 0===o&&(o=!0),!o&&a.matches(e,t.FOCUSABLE_SELECTOR)?e:e.querySelector(t.FOCUSABLE_SELECTOR)}function i(e,o){if(void 0===o&&(o=!0),!o&&a.matches(e,t.FOCUSABLE_SELECTOR))return e;var n=e.querySelectorAll(t.FOCUSABLE_SELECTOR);return n[n.length-1]}t.FOCUSABLE_SELECTOR="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]",t.findFirstFocusableNode=n,t.focusFirstFocusableNode=function(e,t){void 0===t&&(t=!0);var o=n(e,t);o&&o.focus()},t.findLastFocusableNode=i,t.focusLastFocusableNode=function(e,t){void 0===t&&(t=!0);var o=i(e,t);o&&o.focus()}},"./node_modules/@shopify/polaris/dist/esnext/components/ContextualSaveBar/ContextualSaveBar.tsx.esnext":function(e,t,o){"use strict";o.d(t,"a",(function(){return i}));var a=o("./node_modules/react/index.js"),n=o("./node_modules/@shopify/polaris/dist/esnext/utilities/frame/hooks.ts.esnext");const i=Object(a.memo)((function({message:e,saveAction:t,discardAction:o,alignContentFlush:i,fullWidth:s,contextControl:r}){const{setContextualSaveBar:l,removeContextualSaveBar:d}=Object(n.a)();return Object(a.useEffect)(()=>{l({message:e,saveAction:t,discardAction:o,alignContentFlush:i,fullWidth:s,contextControl:r})},[e,t,o,i,l,s,r]),Object(a.useEffect)(()=>d,[d]),null}))},"./packages/@shopify/polaris-next/components/Focus/TrapFocus.tsx":function(e,t,o){"use strict";var a,n=o("./node_modules/react/index.js"),i=o.n(n),s=o("./node_modules/@shopify/polaris/dist/esnext/components/EventListener/EventListener.tsx.esnext"),r=o("./node_modules/@shopify/javascript-utilities/decorators/index.js"),l=o("./node_modules/@shopify/javascript-utilities/dom.js"),d=o("./node_modules/@shopify/javascript-utilities/focus.js"),p=o("./node_modules/react-dom/index.js"),c=o.n(p);class u extends i.a.PureComponent{componentDidMount(){const e=c.a.findDOMNode(this);e&&(document.activeElement||Object(d.focusFirstFocusableNode)(e))}render(){return this.props.children}}function h(e,t,o,a,n){var i={};return Object.keys(a).forEach((function(e){i[e]=a[e]})),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=o.slice().reverse().reduce((function(o,a){return a(e,t,o)||o}),i),n&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(n):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}o.d(t,"a",(function(){return m}));let m=(h((a=class extends i.a.PureComponent{constructor(){super(...arguments),this.focusTrapWrapper=null}render(){const{children:e}=this.props,t="function"==typeof e?e(this.setFocusTrapWrapper):i.a.createElement("div",{ref:this.setFocusTrapWrapper},e);return i.a.createElement(u,null,i.a.createElement(s.a,{event:"focusout",handler:this.handleBlur}),t)}setFocusTrapWrapper(e){this.focusTrapWrapper=e}handleBlur(e){const{relatedTarget:t}=e,{focusTrapWrapper:o}=this,{trapping:a=!0}=this.props;if(null!=t&&!1!==a&&o&&!o.contains(t)&&!Object(l.closest)(t,"[data-polaris-overlay]")){if(e.preventDefault(),e.srcElement===Object(d.findFirstFocusableNode)(o))return Object(d.focusLastFocusableNode)(o);Object(d.focusFirstFocusableNode)(o)}}}).prototype,"setFocusTrapWrapper",[r.autobind],Object.getOwnPropertyDescriptor(a.prototype,"setFocusTrapWrapper"),a.prototype),h(a.prototype,"handleBlur",[r.autobind],Object.getOwnPropertyDescriptor(a.prototype,"handleBlur"),a.prototype),a)},"./packages/@web-utilities/new-design-language/with-new-design-language.tsx":function(e,t,o){"use strict";o.d(t,"a",(function(){return d}));var a=o("./node_modules/react/index.js"),n=o.n(a),i=o("./node_modules/hoist-non-react-statics/dist/hoist-non-react-statics.cjs.js"),s=o.n(i),r=o("./packages/@web-utilities/components/index.ts"),l=o("./packages/@web-utilities/new-design-language/hooks.ts");function d(){return e=>{function t(t){const[o]=Object(l.a)(),a=Object.assign(Object.assign({},t),{newDesignLanguage:o});return n.a.createElement(e,a)}return t.displayName=`withNewDesignLanguage(${Object(r.a)(e)})`,s()(t,e)}}}}]);